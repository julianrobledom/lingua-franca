target Cpp {
    ros2: true,
    timeout: 5 s,
    ros2-dependencies: ["std_msgs"],
}

public preamble {=
    #include "rclcpp/rclcpp.hpp"
    #include "std_msgs/msg/empty.hpp"
=}

reactor Pub {
    private preamble {=
        // FIXME: forward declaration to make the node visible
        extern rclcpp::Node* lf_node;
    =}


    timer t(0, 500 ms)

    output out : std_msgs::msg::Empty

    reaction(startup) {=
     RCLCPP_INFO(lf_node->get_logger(), "Hi");
    =}

    reaction(t) -> out {=
        std_msgs::msg::Empty m;
        out.set(m);
    =}
}

reactor Sub {
    private preamble {=
        // FIXME: forward declaration to make the node visible
        extern rclcpp::Node* lf_node;
    =}
    state count: unsigned(0)

    input in : std_msgs::msg::Empty

    reaction(startup) {=
     RCLCPP_INFO(lf_node->get_logger(), "Hi");
    =}

    reaction(in) {=
        reactor::log::Info() << "I heard";
    =}
}

main reactor {
    @federate
    pub = new Pub()
    @federate
    sub = new Sub()

    reaction(startup) {=
      RCLCPP_INFO(lf_node->get_logger(), "Hi");
    =}

    pub.out -> sub.in
}