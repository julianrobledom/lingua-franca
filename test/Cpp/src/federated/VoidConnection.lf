target Cpp {
    ros2: true,
    keepalive: true,
    ros2-dependencies: ["std_msgs"],
}

public preamble {=
    #include "rclcpp/rclcpp.hpp"
    #include "std_msgs/msg/string.hpp"
=}

reactor Pub {
    private preamble {=
        // FIXME: forward declaration to make the node visible
        extern rclcpp::Node* lf_node;
    =}


    timer t(0, 500 ms)

    output out : void 

    reaction(startup) {=
    =}

    reaction(t) -> out {=
        out.set();
    =}
}

reactor Sub {
    private preamble {=
        // FIXME: forward declaration to make the node visible
        extern rclcpp::Node* lf_node;
    =}
    state count: unsigned(0)

    input in : void

    reaction(startup) {=
    =}

    reaction(in) {=
        reactor::log::Info() << "I heard";
    =}
}

main reactor {
    @federate
    pub = new Pub()
    @federate
    sub = new Sub()

    pub.out -> sub.in
}